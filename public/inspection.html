<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>선진산업시찰 신청 - LOFA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background: #f8f9fa; padding: 30px; font-family: 'Malgun Gothic', sans-serif; }
        .form-card { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        .section-title { border-left: 5px solid #007bff; padding-left: 15px; margin-bottom: 25px; font-weight: bold; }
    </style>
</head>
<body>

<div class="form-card">
    <h3 class="text-center fw-bold text-primary mb-4">
        {% if edit_mode %} <i class="bi bi-pencil-square"></i> 산업시찰 신청 수정 {% else %} ✈️ 선진산업시찰 신청서 {% endif %}
    </h3>

    <form id="welfareForm">
        <input type="hidden" name="edit_idx" value="{{ edit_idx if edit_mode else '' }}">
        <input type="hidden" name="type" value="선진산업시찰">
        
        <div class="section-title text-primary">1. 신청인 정보</div>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="fw-bold">부서</label>
                <input type="text" name="department" class="form-control" value="{{ data.부서 if edit_mode else '' }}" required>
            </div>
            <div class="col-md-6">
                <label class="fw-bold">직급</label>
                <input type="text" name="position" class="form-control" value="{{ data.직급 if edit_mode else '' }}" required>
            </div>
            <div class="col-md-6">
                <label class="fw-bold">성명</label>
                <input type="text" class="form-control bg-light" value="{{ user_name }}" readonly>
            </div>
            <div class="col-md-6">
                <label class="fw-bold">전화번호</label>
                <input type="text" name="phone" class="form-control" value="{{ data.전화번호 if edit_mode else '' }}" placeholder="010-0000-0000" required>
            </div>
        </div>

        <div class="section-title text-primary">2. 시찰 상세내역</div>
        <div class="row g-3 mb-4">
            <div class="col-md-12">
                <label class="fw-bold">시찰 장소 (국가/도시)</label>
                <input type="text" name="target_name" class="form-control" placeholder="예: 독일 뮌헨 등" value="{{ data.대상자성명 if edit_mode else '' }}" required>
            </div>
            <div class="col-md-12">
                <label class="fw-bold">시찰 일정 및 목적</label>
                <textarea name="detail_text" class="form-control" rows="3" placeholder="시찰 기간 및 주요 방문 목적을 입력하세요." required>{{ data.세부내용 if edit_mode else '' }}</textarea>
            </div>
            <div class="col-md-12">
                <label class="fw-bold text-primary">신청 금액 (실 소요비용)</label>
                <div class="input-group">
                    <input type="number" name="amount" class="form-control fw-bold text-end" value="{{ data.신청금액 if edit_mode else '' }}" required>
                    <span class="input-group-text">원</span>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label class="fw-bold mb-1">계좌번호 (은행/번호/예금주)</label>
            <input type="text" name="account" class="form-control" value="{{ data.계좌번호 if edit_mode else '' }}" required>
        </div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg shadow fw-bold">
                {% if edit_mode %} ✅ 수정 완료 및 재제출 {% else %} ✈️ 시찰 신청하기 {% endif %}
            </button>
            <a href="/my_status" class="btn btn-outline-secondary">취소하고 돌아가기</a>
        </div>
    </form>
</div>

<script>
    document.getElementById('welfareForm').onsubmit = async (e) => {
        e.preventDefault();
        
        const url = "{{ '/edit_submit' if edit_mode else '/submit' }}";
        const formData = new FormData(e.target);

        try {
            const res = await fetch(url, { method: 'POST', body: formData });
            const result = await res.json();
            if(result.status === 'success') {
                alert(url.includes('edit') ? '산업시찰 신청서가 성공적으로 수정되었습니다.' : '산업시찰 신청서가 제출되었습니다.');
                location.href = '/my_status';
            } else {
                alert('오류: ' + result.message);
            }
        } catch (err) {
            alert('서버와 통신하는 중 오류가 발생했습니다.');
        }
    };
</script>
</body>
</html>