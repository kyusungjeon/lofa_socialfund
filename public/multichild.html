<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‹¤ìë…€ ë³´ìœ¡ ì§€ì› ì‹ ì²­ì„œ - LOFA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f9; padding: 40px 0; font-family: 'Malgun Gothic', sans-serif; }
        .form-card { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header-line { border-left: 5px solid #6c5ce7; padding-left: 15px; margin-bottom: 30px; }
        .section-title { font-size: 1.1rem; font-weight: bold; color: #6c5ce7; margin-top: 25px; margin-bottom: 15px; border-bottom: 2px solid #e9ecef; padding-bottom: 5px; }
        .child-item { background-color: #f8f7ff; border: 1px solid #dcdde1; border-radius: 10px; padding: 15px; margin-bottom: 10px; position: relative; }
        .info-text { background-color: #f0f1f8; border-radius: 10px; padding: 15px; font-size: 0.9rem; color: #444; border: 1px solid #dcdde1; }
        .btn-remove { position: absolute; top: 10px; right: 10px; padding: 0px 8px; font-size: 0.8rem; }
    </style>
</head>
<body>
<div class="container" style="max-width: 800px;">
    <div class="form-card">
        <div class="header-line">
            <h2 class="fw-bold">ë‹¤ìë…€ ë³´ìœ¡ ì§€ì› ì‹ ì²­ì„œ</h2>
            <p class="text-muted mb-0">ë‹¤ìë…€ ê°€êµ¬ ì„ì§ì›ì„ ìœ„í•œ ë³´ìœ¡ ë° êµìœ¡ ì§€ì› ì‹ ì²­ ì–‘ì‹ì…ë‹ˆë‹¤.</p>
        </div>

        <form id="multiChildForm" enctype="multipart/form-data">
            <input type="hidden" name="type" value="ë‹¤ìë…€ì§€ì›">

            <div class="section-title">1. ì‹ ì²­ì¸ ì •ë³´</div>
            <div class="row g-3">
                <div class="col-md-4"><label class="form-label fw-bold">ì†Œì†ë¶€ì„œ</label><input type="text" name="department" class="form-control" required></div>
                <div class="col-md-4"><label class="form-label fw-bold">ì§ê¸‰</label><input type="text" name="position" class="form-control" required></div>
                <div class="col-md-4"><label class="form-label fw-bold">ì‚¬ë²ˆ</label><input type="text" name="employeeId" class="form-control" required></div>
                <div class="col-md-4"><label class="form-label fw-bold">ì„±ëª…</label><input type="text" name="employeeName" class="form-control" value="{{ user_name }}" readonly></div>
                <div class="col-md-4"><label class="form-label fw-bold">ì—°ë½ì²˜</label><input type="tel" name="phone" class="form-control" placeholder="010-0000-0000" required></div>
                <div class="col-md-4"><label class="form-label fw-bold">ìë…€ìˆ˜</label><input type="number" name="child_count" class="form-control" placeholder="ëª…" required></div>
            </div>

            <div class="section-title d-flex justify-content-between align-items-center">
                2. ì§€ì› ëŒ€ìƒ ìë…€ ì •ë³´
                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addChildItem()">+ ìë…€ ì¶”ê°€</button>
            </div>
            <div id="childList">
                <div class="child-item">
                    <div class="row g-2">
                        <div class="col-md-4"><input type="text" name="child_name[]" class="form-control form-control-sm" placeholder="ìë…€ ì„±ëª…" required></div>
                        <div class="col-md-4"><input type="date" name="child_birth[]" class="form-control form-control-sm" required></div>
                        <div class="col-md-4"><input type="text" name="child_relation[]" class="form-control form-control-sm" placeholder="ê´€ê³„ (ì˜ˆ: ì)" required></div>
                    </div>
                </div>
            </div>

            <div class="section-title">3. ì§€ì›ê¸ˆ ì‹ ì²­ ì •ë³´</div>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label fw-bold">ì‹ ì²­ ê¸ˆì•¡</label>
                    <input type="number" name="amount" class="form-control" placeholder="ìˆ«ìë§Œ ì…ë ¥" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">ì§€ê¸‰ ê³„ì¢Œë²ˆí˜¸</label>
                    <input type="text" name="account" class="form-control" placeholder="ì€í–‰ëª… ë° ê³„ì¢Œë²ˆí˜¸" required>
                </div>
            </div>

            <div class="section-title">4. ì¦ë¹™ì„œë¥˜ ì œì¶œ</div>
            <div class="info-text mb-3">
                <strong>[í•„ìˆ˜ ì¦ë¹™ ì„œë¥˜]</strong><br>
                - ì£¼ë¯¼ë“±ë¡ë“±ë³¸ ë˜ëŠ” ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ 1ë¶€ (ë‹¤ìë…€ í™•ì¸ìš©)<br>
                - ë³´ìœ¡ë£Œ/êµìœ¡ë¹„ ë‚©ì… ì¦ëª…ì„œ (í•´ë‹¹ ì‹œ)
            </div>
            <div class="mb-4">
                <label class="form-label fw-bold">ì¦ë¹™ íŒŒì¼ ì—…ë¡œë“œ</label>
                <input type="file" name="attachment" class="form-control">
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-lg text-white" style="background-color: #6c5ce7; border: none;">ë‹¤ìë…€ ì§€ì› ì‹ ì²­</button>
                <a href="/" class="btn btn-light">ì´ì „ ë©”ë‰´ë¡œ</a>
            </div>
        </form>
    </div>
</div>

<script>
function addChildItem() {
    const container = document.getElementById('childList');
    const newItem = document.createElement('div');
    newItem.className = 'child-item';
    newItem.innerHTML = `
        <button type="button" class="btn btn-close btn-remove" onclick="this.parentElement.remove();"></button>
        <div class="row g-2">
            <div class="col-md-4"><input type="text" name="child_name[]" class="form-control form-control-sm" placeholder="ìë…€ ì„±ëª…" required></div>
            <div class="col-md-4"><input type="date" name="child_birth[]" class="form-control form-control-sm" required></div>
            <div class="col-md-4"><input type="text" name="child_relation[]" class="form-control form-control-sm" placeholder="ê´€ê³„ (ì˜ˆ: ì)" required></div>
        </div>
    `;
    container.appendChild(newItem);
}

document.getElementById('multiChildForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    // ìë…€ ì •ë³´ë¥¼ ìš”ì•½ ë¬¸ìì—´ë¡œ ë³€í™˜
    let childStr = "";
    const names = formData.getAll('child_name[]');
    const births = formData.getAll('child_birth[]');
    names.forEach((name, i) => {
        childStr += `${name}(${births[i]}) `;
    });

    formData.append('content', `ë¶€ì„œ:${formData.get('department')}, ì´ìë…€ìˆ˜:${formData.get('child_count')}, ëŒ€ìƒ:${childStr}, ê³„ì¢Œ:${formData.get('account')}, ì‹ ì²­ì•¡:${formData.get('amount')}`);

    const res = await fetch('/submit', { method: 'POST', body: formData });
    const data = await res.json();
    if(data.status === 'success') {
        alert('ë‹¤ìë…€ ë³´ìœ¡ ì§€ì› ì‹ ì²­ì„œê°€ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.href = '/';
    } else {
        alert('ì—ëŸ¬ ë°œìƒ: ' + data.message);
    }
};
</script>

<div class="form-card shadow p-4 bg-white rounded">
    <h3 class="fw-bold text-info mb-4 text-center">ğŸ‘¶ ë‹¤ìë…€ê°€ì • ìƒí™œì§€ì› ì‹ ì²­ì„œ</h3>
    <div id="hiddenStore" data-detail="{{ data.ì„¸ë¶€ë‚´ìš© if data.ì„¸ë¶€ë‚´ìš© else '' }}" style="display:none;"></div>
    <form id="welfareForm">
        <input type="hidden" name="type" value="ë‹¤ìë…€ê°€ì •ì§€ì›">
        <div class="section-title">ìë…€ ì •ë³´ (ë¯¸ì·¨í•™ ìë…€ ëª©ë¡)</div>
        <div id="rowContainer"></div>
        <button type="button" class="btn btn-outline-info btn-sm mb-4" onclick="addRow()">+ ìë…€ ì¶”ê°€</button>
        <div class="mb-3"><label>ì‹ ì²­ ê¸ˆì•¡</label><input type="number" name="amount" class="form-control" value="{{ data.ì‹ ì²­ê¸ˆì•¡ if data else 0 }}"></div>
        <div class="mb-4"><label>ê³„ì¢Œë²ˆí˜¸</label><input type="text" name="account" class="form-control" value="{{ data.ê³„ì¢Œë²ˆí˜¸ if data else '' }}"></div>
        <div class="alert alert-info small"><b>ì²¨ë¶€ì„œë¥˜:</b> ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ ë“± ë¯¸ì·¨í•™ ë‹¤ìë…€ ì¦ë¹™</div>
        <button type="submit" class="btn btn-info w-100 text-white btn-lg">ì œì¶œí•˜ê¸°</button>
    </form>
</div>
<script>
    function addRow(n='', b='', p='', no='') {
        const div = document.createElement('div'); div.className = 'p-3 border rounded mb-2 bg-light';
        div.innerHTML = `<div class="row g-2">
                <div class="col-md-3"><input type="text" name="c_name[]" class="form-control form-control-sm" placeholder="ì„±ëª…" value="${n}"></div>
                <div class="col-md-3"><input type="date" name="c_birth[]" class="form-control form-control-sm" value="${b}"></div>
                <div class="col-md-3"><input type="text" name="c_plan[]" class="form-control form-control-sm" placeholder="ì·¨í•™ì˜ˆì •ì¼" value="${p}"></div>
                <div class="col-md-3"><input type="text" name="c_note[]" class="form-control form-control-sm" placeholder="ë¹„ê³ " value="${no}"></div>
            </div>`;
        document.getElementById('rowContainer').appendChild(div);
    }
    // ... (ìë°”ìŠ¤í¬ë¦½íŠ¸ ë³µêµ¬ ë¡œì§ ë™ì¼) ...
</script>
</body>
</html>